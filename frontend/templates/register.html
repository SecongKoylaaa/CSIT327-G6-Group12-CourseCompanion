<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Register</title>
  <link rel="stylesheet" href="/static/css/style.css">
  <style>
    .error { color: red; font-size: 14px; margin-top: 4px; }
    .success { color: green; font-size: 14px; margin-top: 4px; }
  </style>
</head>
<body>
  <div class="container">
    <img src="https://img.icons8.com/ios-filled/100/000000/handshake.png" alt="logo">
    <h2>Sign Up</h2>

    <!-- Form posts to Django view -->
    <form id="registerForm" method="post" action="">
      {% csrf_token %}
      <input type="email" name="email" id="email" placeholder="Email *" required maxlength="50">
      <div id="emailError" class="error"></div>

      <div class="password-container">
        <input type="password" name="password" id="password" placeholder="Password *" required maxlength="30">
        <button type="button" id="togglePassword" class="show-password">&#128065;</button>
      </div>

      <div class="password-container">
        <input type="password" name="confirmPassword" id="confirmPassword" placeholder="Confirm Password *" required maxlength="30">
        <button type="button" id="toggleConfirmPassword" class="show-password">&#128065;</button>
      </div>

      <div class="links">Already a member? <a href="/login">Log In</a></div>
      <button type="submit">Continue</button>

      {% if error %}
      <div class="error">{{ error }}</div>
      {% endif %}

    </form>
  </div>

  <script>
    const form = document.getElementById("registerForm");

    form.addEventListener("submit", e => {
      // Client-side validation
      const email = form.email.value.trim();
      const password = form.password.value.trim();
      const confirm = form.confirmPassword.value.trim();

      const emailError = document.getElementById("emailError");
      const passwordError = document.getElementById("passwordError");
      const confirmError = document.getElementById("confirmPasswordError");

      [emailError, passwordError, confirmError].forEach(el => el.textContent = "");

      const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!email) { emailError.textContent = "Email is required"; e.preventDefault(); return; }
      if (!emailPattern.test(email)) { emailError.textContent = "Please enter a valid email address"; e.preventDefault(); return; }

      if (!password) { passwordError.textContent = "Password is required"; e.preventDefault(); return; }
      if (password.length < 8) { passwordError.textContent = "Password must be at least 8 characters long."; e.preventDefault(); return; }
      if (!/[A-Z]/.test(password)) { passwordError.textContent = "Password must contain an uppercase letter."; e.preventDefault(); return; }
      if (!/[0-9]/.test(password)) { passwordError.textContent = "Password must contain a number."; e.preventDefault(); return; }
      if (!/[!@#$%^&*(),.?":{}|<>]/.test(password)) { passwordError.textContent = "Password must contain a special character."; e.preventDefault(); return; }

      if (!confirm) { confirmError.textContent = "Please confirm your password"; e.preventDefault(); return; }
      if (password !== confirm) { confirmError.textContent = "Passwords do not match"; e.preventDefault(); return; }
    });

    // Register form toggle (password)
    const togglePassword = document.getElementById("togglePassword");
    const password = document.getElementById("password");

    togglePassword.addEventListener("click", () => {
      password.type = password.type === "password" ? "text" : "password";
    });

    // Register form toggle (confirm password)
    const toggleConfirmPassword = document.getElementById("toggleConfirmPassword");
    const confirmPassword = document.getElementById("confirmPassword");

    toggleConfirmPassword.addEventListener("click", () => {
      confirmPassword.type = confirmPassword.type === "password" ? "text" : "password";
    });

    const MAX_EMAIL_LENGTH = 50;
    const MAX_PASSWORD_LENGTH = 30;

    // Registration form
    form.addEventListener("submit", e => {
      const email = form.email.value.trim();
      const password = form.password.value.trim();
      const confirm = form.confirmPassword.value.trim();

      const emailError = document.getElementById("emailError");
      const passwordError = document.getElementById("passwordError");
      const confirmError = document.getElementById("confirmPasswordError");

      [emailError, passwordError, confirmError].forEach(el => el.textContent = "");

      if (email.length > MAX_EMAIL_LENGTH) {
        emailError.textContent = `Email cannot exceed ${MAX_EMAIL_LENGTH} characters.`;
        e.preventDefault();
        return;
      }

      if (password.length > MAX_PASSWORD_LENGTH) {
        passwordError.textContent = `Password cannot exceed ${MAX_PASSWORD_LENGTH} characters.`;
        e.preventDefault();
        return;
      }

      if (confirm.length > MAX_PASSWORD_LENGTH) {
        confirmError.textContent = `Password cannot exceed ${MAX_PASSWORD_LENGTH} characters.`;
        e.preventDefault();
        return;
      }
    });
  </script>
</body>
</html>
