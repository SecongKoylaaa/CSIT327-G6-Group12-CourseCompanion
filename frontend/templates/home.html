{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Course Companion</title>
  <link rel="stylesheet" href="{% static 'css/home.css' %}">
</head>
<body>
  <!-- NAVBAR -->
  <nav class="navbar">
    <div class="nav-left">
      <img src="https://img.icons8.com/ios-filled/50/ff4500/handshake.png" alt="logo" class="logo">
      <h1 class="logo-text">Course Companion</h1>
    </div>

    <div class="nav-center">
      <input type="text" class="search-bar" placeholder="Search Course Companion...">
    </div>

    <div class="nav-right">
      <a href="{% url 'create-post-text' %}" class="create-btn">+ Create</a>

      <div class="profile-dropdown">
        <button class="profile-btn">üë§</button>
        <div class="dropdown-content">
          <a href="#">View Profile</a>
          <a href="/logout/">Logout</a>
        </div>
      </div>
    </div>
  </nav>

  <!-- MAIN LAYOUT -->
  <div class="main-layout">
    <div class="container">
      {% for post in posts %}
      <div class="post">
        <p><b>{{ post.course }}</b> ‚Ä¢ {{ post.created_at }}</p>
        <h3>{{ post.title }}</h3>

        {% if post.description %}
          <p class="post-description">{{ post.description }}</p>
        {% endif %}

        {% if post.is_image %}
          <img src="{{ post.url }}" alt="Post Image" class="post-thumbnail">
        {% elif post.is_video %}
          <video class="post-thumbnail" src="{{ post.url }}" controls></video>
        {% elif post.url %}
          <a href="{{ post.url }}" target="_blank">{{ post.url }}</a>
        {% endif %}

        <div class="actions">
          <span>‚¨ÜÔ∏è 15</span>
          <span class="comment-toggle" onclick="toggleComments(this)">üí¨ {{ post.comment_count }}</span>
          <span>üîó Share</span>
        </div>

        <!-- COMMENTS SECTION -->
        <div class="expanded-section">
          <div class="comments-area">
            <h4>Comments</h4>

            <!-- ‚úÖ Real comments -->
            {% for comment in post.comments %}
              <div class="comment">
                <strong>{{ comment.author }}</strong> 
                <span>‚Ä¢ {{ comment.created_at }}</span>
                <p>{{ comment.content }}</p>
              </div>
            {% empty %}
              <p class="no-comments">No comments yet.</p>
            {% endfor %}

            <!-- ‚úÖ Static test comments -->
            <div class="comment">
              <strong>user123</strong> <span>‚Ä¢ 2h ago</span>
              <p>Nice post! [static comment - test]</p>
            </div>
            <div class="comment">
              <strong>janedoe</strong> <span>‚Ä¢ 1h ago</span>
              <p>Can you share your notes? [static comment - test]</p>
            </div>

            <form class="comment-form" method="POST" action="{% url 'home' %}">
              {% csrf_token %}
              <input type="hidden" name="post_id" value="{{ post.id }}">
              <input type="text" name="comment" placeholder="Add a comment..." required>
              <button type="submit">Post</button>
            </form>
          </div>
        </div>
      </div>
      {% empty %}
        <p>No posts available.</p>
      {% endfor %}
    </div>

    <aside class="sidebar">
      <h3>Communities</h3>
      <ul>
        <li>r/Psychology</li>
        <li>r/HowToProgramming</li>
        <li>r/ThisIsATest</li>
        <li>r/HelloWorld</li>
        <li>r/Nursing</li>
        <li>r/Engineering</li>
      </ul>
    </aside>
  </div>

  <script>
  function toggleComments(el) {
    const post = el.closest(".post");
    post.classList.toggle("show-expanded");
  }

  document.addEventListener('click', function(e) {
    const dropdown = document.querySelector('.dropdown-content');
    const button = document.querySelector('.profile-btn');
    if (button.contains(e.target)) {
      dropdown.classList.toggle('show');
    } else {
      dropdown.classList.remove('show');
    }
  });
  </script>
</body>
</html>
