{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Create Post (Link)</title>
  <link rel="stylesheet" href="{% static 'css/layout.css' %}">
  <link rel="stylesheet" href="{% static 'css/navbar.css' %}">
  <link rel="stylesheet" href="{% static 'css/post-create.css' %}">
</head>
<body>

<!-- ✅ NAVBAR (click logo/text to go home, layout intact) -->
{% include "navbar.html" %}


<!-- ✅ MAIN CREATE POST SECTION -->
<div class="create-container">
  <div class="create-card">
    <h1>Create a Post</h1>

    <!-- Course Selector -->
    <label>Select a Course <span class="required">*</span></label>
    <select id="course" name="course" required>
      <option value="" disabled {% if not course %}selected{% endif %}>Select a course</option>
      <option value="Computer Science 101" {% if course == "Computer Science 101" %}selected{% endif %}>Computer Science 101</option>
      <option value="Information Technology 102" {% if course == "Information Technology 102" %}selected{% endif %}>Information Technology 102</option>
      <option value="Software Engineering 103" {% if course == "Software Engineering 103" %}selected{% endif %}>Software Engineering 103</option>
      <option value="Database Systems 104" {% if course == "Database Systems 104" %}selected{% endif %}>Database Systems 104</option>
    </select>

    <!-- Tabs -->
    <div class="tabs">
      <a href="{% url 'create-post-text' %}">Text</a>
      <a href="{% url 'create-post-image-video' %}">Images & Video</a>
      <a href="{% url 'create-post-link' %}" class="active">Link</a>
    </div>

    <!-- Form -->
    <form method="POST">
      {% csrf_token %}

      <label for="title">Title <span class="required">*</span></label>
      <input id="title" name="title" type="text" maxlength="200" placeholder="Enter title" required>
      <div class="char-count" id="title-count">0/200</div>

      <!-- Tag Selector -->
      <div class="tag-selector">
        <label>Add Tag</label>
        <button type="button" id="tag-btn">Add tags</button>
        <div id="tag-choices" class="tag-choices-horizontal" style="display:none;">
          <button type="button" class="tag-choice-btn" data-value="question">Question</button>
          <button type="button" class="tag-choice-btn" data-value="announcement">Announcement</button>
          <button type="button" class="tag-choice-btn" data-value="discussion">Discussion</button>
        </div>
        <input type="hidden" name="post_type" id="post_type" required>
      </div>

      <!-- URL Input -->
      <label for="url">Link URL <span class="required">*</span></label>
      <input id="url" name="url" type="url" placeholder="https://example.com" required>

      {% if error %}
        <div class="error">{{ error }}</div>
      {% endif %}
      {% if success %}
        <div class="success">{{ success }}</div>
      {% endif %}

      <button type="submit" class="post-btn">Post</button>
    </form>
  </div>
</div>

<!-- JS -->
<script>
  // Character counter for title only
  const titleInput = document.getElementById('title');
  const titleCount = document.getElementById('title-count');

  titleInput.addEventListener('input', () => {
    titleCount.textContent = `${titleInput.value.length}/200`;
  });

  // Tag dropdown
  const tagBtn = document.getElementById('tag-btn');
  const tagChoices = document.getElementById('tag-choices');

  tagBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    tagChoices.style.display = tagChoices.style.display === 'flex' ? 'none' : 'flex';
  });

  document.querySelectorAll('.tag-choice-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      tagBtn.textContent = btn.textContent;
      document.getElementById('post_type').value = btn.getAttribute('data-value');
      tagChoices.style.display = 'none';
    });
  });

  document.addEventListener('click', () => tagChoices.style.display = 'none');

  // Profile dropdown toggle
  document.addEventListener('click', function(e) {
    const dropdown = document.querySelector('.dropdown-content');
    const button = document.querySelector('.profile-btn');
    if (button.contains(e.target)) {
      dropdown.classList.toggle('show');
    } else {
      dropdown.classList.remove('show');
    }
  });
</script>
</body>
</html>